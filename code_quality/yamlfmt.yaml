parameters:
  - name: SOURCE_FOLDER
    type: string
    default: '.'

steps:
  - powershell: |
      # Manually add Go installed by Chocolatey to PATH (user-level path)
      $goPath = "C:\ProgramData\chocolatey\lib\golang\tools\go\bin"
      $env:PATH += ";$goPath"

      # Confirm Go is now accessible
      go version

      # Install yamlfmt
      go install github.com/google/yamlfmt/cmd/yamlfmt@latest

      # Ensure go/bin is also in PATH
      $env:PATH += ";$env:USERPROFILE\go\bin"

      # Run yamlfmt
      yamlfmt --version
      yamlfmt -lint ${{ parameters.SOURCE_FOLDER }}
    displayName: 'Install and Run yamlfmt'
