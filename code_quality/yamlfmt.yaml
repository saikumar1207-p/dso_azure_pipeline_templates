parameters:
  - name: SOURCE_FOLDER
    type: string
    default: '.'

steps:
  - powershell: |
      choco install golang -y
    displayName: Install Golang using Chocolatey

  - powershell: |
      # Set GOPATH env variable for this session
      $env:GOPATH = "$env:USERPROFILE\go"
      # Add GOPATH\bin to PATH env variable for this session
      $env:PATH += ";$env:GOPATH\bin"
      
      go install github.com/google/yamlfmt/cmd/yamlfmt@latest
    displayName: Install yamlfmt

  - powershell: |
      # Add GOPATH\bin to PATH again before running yamlfmt
      $env:PATH += ";$env:GOPATH\bin"
      
      Write-Host "Running yamlfmt on folder: ${{ parameters.SOURCE_FOLDER }}"
      yamlfmt -lint ${{ parameters.SOURCE_FOLDER }}
    displayName: Run yamlfmt
