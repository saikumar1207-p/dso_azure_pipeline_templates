parameters:
  - name: SOURCE_FOLDER
    type: string
    default: '.'

steps:
  - powershell: |
      # Install Go if needed
      choco install golang -y

      # Set GOPATH manually in case it's not already set
      $env:GOPATH = "$env:USERPROFILE\go"
      $env:PATH += ";$env:GOPATH\bin"

      # Confirm Go is available
      go version

      # Install yamlfmt
      go install github.com/google/yamlfmt/cmd/yamlfmt@latest

      # Use yamlfmt immediately
      yamlfmt --version
      yamlfmt -lint ${{ parameters.SOURCE_FOLDER }}
    displayName: 'Install and Run yamlfmt'
