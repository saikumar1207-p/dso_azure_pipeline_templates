parameters:
  - name: SOURCE_FOLDER
    type: string
    default: '.'

steps:
  - powershell: |
      choco install golang -y
    displayName: 'Install Go (Golang)'

  - powershell: |
      # Refresh environment variable for Go bin folder so yamlfmt is accessible
      $env:PATH += ";$env:USERPROFILE\go\bin"

      # Install yamlfmt
      go install github.com/google/yamlfmt/cmd/yamlfmt@latest

      # Check yamlfmt version
      yamlfmt --version
    displayName: 'Install yamlfmt'

  - powershell: |
      # Run yamlfmt lint on the source folder
      yamlfmt -lint ${{ parameters.SOURCE_FOLDER }}
    displayName: 'Run yamlfmt'
